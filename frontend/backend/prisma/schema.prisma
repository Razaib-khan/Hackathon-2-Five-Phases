// prisma/schema.prisma
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id             String           @id @default(uuid())
  email          String           @unique
  password_hash  String
  is_active      Boolean          @default(true)
  created_at     DateTime         @default(now())
  updated_at     DateTime         @updatedAt

  // Relationships
  tasks          Task[]
  tags           Tag[]
  analytics      Analytics[]
  preferences    UserPreferences?
}

model Task {
  id              String           @id @default(uuid())
  user_id         String
  title           String
  description     String?
  completed       Boolean          @default(false)
  priority        String           @default("none") @db.VarChar(10) // high, medium, low, none
  due_date        DateTime?
  created_at      DateTime         @default(now())
  updated_at      DateTime         @updatedAt
  completed_at    DateTime?
  estimated_time  Int?
  category        String?
  position        Int?
  reminder_time   DateTime?
  time_spent      Int              @default(0)
  status          String           @default("todo") @db.VarChar(20) // todo, in_progress, done

  // Relationships
  user            User             @relation(fields: [user_id], references: [id], onDelete: Cascade)
  subtasks        Subtask[]
  task_tags       TaskTag[]

  @@index([user_id])
  @@index([status])
  @@index([priority])
  @@index([due_date])
}

model Tag {
  id         String        @id @default(uuid())
  user_id    String
  name       String
  color      String        @db.VarChar(7) // hex color
  created_at DateTime      @default(now())
  updated_at DateTime      @updatedAt

  // Relationships
  user       User          @relation(fields: [user_id], references: [id], onDelete: Cascade)
  task_tags  TaskTag[]

  @@index([user_id])
}

model Subtask {
  id          String        @id @default(uuid())
  task_id     String
  title       String
  completed   Boolean       @default(false)
  order_index Int
  created_at  DateTime      @default(now())
  updated_at  DateTime      @updatedAt

  // Relationships
  task        Task          @relation(fields: [task_id], references: [id], onDelete: Cascade)
}

model TaskTag {
  id         String        @id @default(uuid())
  task_id    String
  tag_id     String
  created_at DateTime      @default(now())

  // Relationships
  task       Task          @relation(fields: [task_id], references: [id], onDelete: Cascade)
  tag        Tag           @relation(fields: [tag_id], references: [id], onDelete: Cascade)

  @@unique([task_id, tag_id])
}

model Analytics {
  id                   String        @id @default(uuid())
  user_id              String
  date                 DateTime      @db.Date
  tasks_created        Int           @default(0)
  tasks_completed      Int           @default(0)
  time_spent_minutes   Int           @default(0)
  created_at           DateTime      @default(now())
  updated_at           DateTime      @updatedAt

  // Relationships
  user                 User          @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@index([user_id])
  @@index([date])
}

model UserPreferences {
  id         String        @id @default(uuid())
  user_id    String        @unique
  theme      String        @default("light") @db.VarChar(20)
  timezone   String        @default("UTC") @db.VarChar(50)
  language   String        @default("en") @db.VarChar(10)
  created_at DateTime      @default(now())
  updated_at DateTime      @updatedAt

  // Relationships
  user       User          @relation(fields: [user_id], references: [id], onDelete: Cascade)
}